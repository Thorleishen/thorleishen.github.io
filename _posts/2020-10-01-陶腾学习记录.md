## å­¦ä¹ ç¬”è®°ä¹‹ä¸€



[TOC]



1. mysqlæŸ¥è¯¢æ•°æ®åº“åå’ŒæŸ¥è¯¢æ•°æ®åº“å¯¹åº”çš„è¡¨å

   ```mysql
   -- æŸ¥è¯¢æŸæ•°æ®åº“ä¸­æ‰€æœ‰è¡¨
   select count(*) from information_schema.TABLES t where t.TABLE_SCHEMA ="æ•°æ®åº“å" and t.TABLE_NAME ="æ•°æ®åº“è¡¨å";
   -- æ¨¡ç³ŠæŸ¥è¯¢æŸæ•°æ®åº“ä¸­çš„è¡¨
   select count(*) from information_schema.TABLES t where t.TABLE_SCHEMA ="æ•°æ®åº“å" and t.TABLE_NAME like "%æ•°æ®åº“è¡¨å%";
   ```

2. mysqlèšåˆæŸ¥è¯¢æŠ¥é”™

   ```mysql
   select count(*) from (select * from dede_spacemoney group by sid)Â ;
   -- å½“æˆ‘æ‰§è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™å°±æŠ›å‡ºäº†è¿™ä¸ªå¼‚å¸¸ï¼ŒåŸæ¥æˆ‘è¿›è¡ŒåµŒå¥—æŸ¥è¯¢çš„æ—¶å€™å­æŸ¥è¯¢å‡ºæ¥çš„çš„ç»“æœæ˜¯ä½œä¸ºä¸€ä¸ªæ´¾ç”Ÿè¡¨æ¥è¿›è¡Œä¸Šä¸€çº§çš„æŸ¥è¯¢çš„ï¼Œæ‰€ä»¥å­æŸ¥è¯¢çš„ç»“æœå¿…é¡»è¦æœ‰ä¸€ä¸ªåˆ«å
   
   -- æŠŠMySQLè¯­å¥æ”¹æˆï¼š
   select count(*) from (select * from list where name="xiao") as t;
   
   -- é—®é¢˜å°±è§£å†³äº†ï¼Œè™½ç„¶åªåŠ äº†ä¸€ä¸ªæ²¡æœ‰ä»»ä½•ä½œç”¨çš„åˆ«åtï¼Œä½†è¿™ä¸ªåˆ«åæ˜¯å¿…é¡»çš„ï¼
   ```

3. æŸ¥è¯¢æ•°æ®åº“è¡¨ç»“æ„å¤§å°

   ```mysqL
   -- 1ã€è¿›å…¥information_schema æ•°æ®åº“ï¼ˆå­˜æ”¾äº†å…¶ä»–çš„æ•°æ®åº“çš„ä¿¡æ¯ï¼‰
   
   use information_schema;
   
      
   
   -- 2ã€æŸ¥è¯¢æ‰€æœ‰æ•°æ®çš„å¤§å°ï¼š
   
   select concat(round(sum(data_length/1024/1024),2),'MB') as data from tables;
   
      
   
   -- 3ã€æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“çš„å¤§å°ï¼šæ¯”å¦‚æŸ¥çœ‹æ•°æ®åº“homeçš„å¤§å°
   
   select concat(round(sum(data_length/1024/1024),2),'MB') as data from tables where table_schema='home';
   
      
   
   -- 4ã€æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“çš„æŸä¸ªè¡¨çš„å¤§å°ï¼Œæ¯”å¦‚æŸ¥çœ‹æ•°æ®åº“homeä¸­ members è¡¨çš„å¤§å°
   
   select concat(round(sum(data_length/1024/1024),2),'MB') as data from tables where table_schema='home' and table_name='members';
   ```

   

æ•°æ®åº“5.7å®‰è£…ï¼šhttps://www.cnblogs.com/fanshudada/p/9781794.html



#### ç¬¬ä¸€å‘¨2020/4/27-2020/5/3

```python
# pymongoæ“ä½œmongodbæ•°æ®åº“ï¼Œä½¿ç”¨skipå’Œlimitæ–¹æ³•
# é—®é¢˜ï¼šä½¿ç”¨countæ–¹æ³•æ—¶å¾—ä¸åˆ°å‡†ç¡®çš„æ•°æ®æ¡æ•°
# è§£å†³åŠæ³•
db.dbname.find().skip().limit().count(True)
```



#### ç¬¬äºŒå‘¨2020/5/6-2020/5/9

```mysql
# é—®é¢˜ï¼šè§£å†³å¤šå°æœåŠ¡å™¨æ“ä½œåŒä¸€ä¸ªmysqlæ•°æ®åº“ï¼Œå…¶ä¸­ä¸€å°æœåŠ¡å™¨å¯¹mysqlè¿›è¡Œå¢åˆ æ”¹æ“ä½œï¼Œå…¶ä»–æœåŠ¡å™¨æŸ¥è¯¢ä¸åˆ°å¢åˆ æ”¹åçš„æ•°æ®ï¼Œè¿˜æ˜¯æŸ¥è¯¢åˆ°çš„æ˜¯ä»¥å¾€çš„æ•°æ®
# ç±»ä¼¼é—®é¢˜ï¼šä½¿ç”¨pymysqlè¿›è¡Œå®šæ—¶æŸ¥è¯¢ï¼ˆä¸å…³é—­æ•°æ®åº“ï¼‰ï¼Œå®šæ—¶æ’å…¥æ•°æ®ï¼Œpymysqlå†æ¬¡æŸ¥è¯¢çš„æ•°æ®ä¸æ›´æ–°
# åŸå› ï¼š
REPEATABLE READ
The default isolation level for InnoDB. It prevents any rows that are queried from being
changed by other transactions, thus blocking non-repeatable reads but not phantom reads.
It uses a moderately strict locking strategy so that all queries within a transaction see
data from the same snapshot, that is, the data as it was at the time the transaction started.
é‡å¤è¯»
innodbçš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚å®ƒé˜²æ­¢æŸ¥è¯¢çš„ä»»ä½•è¡Œ
ç”±å…¶ä»–äº‹åŠ¡æ›´æ”¹ï¼Œå› æ­¤é˜»æ­¢ä¸å¯é‡å¤çš„è¯»å–ï¼Œä½†ä¸é˜»æ­¢å¹»è±¡è¯»å–ã€‚
å®ƒä½¿ç”¨é€‚åº¦ä¸¥æ ¼çš„é”å®šç­–ç•¥ï¼Œä»¥ä¾¿äº‹åŠ¡ä¸­çš„æ‰€æœ‰æŸ¥è¯¢éƒ½å¯ä»¥çœ‹åˆ°
æ¥è‡ªåŒä¸€å¿«ç…§çš„æ•°æ®ï¼Œå³äº‹åŠ¡å¯åŠ¨æ—¶çš„æ•°æ®ã€‚
# è§£å†³åŠæ³•ï¼šæ¯æ¬¡æ‰§è¡ŒæŸ¥è¯¢æ“ä½œæ—¶ï¼Œæ›´æ–°æŸ¥è¯¢äº‹åŠ¡
db.cursor.execute(sql)
db.cursor.fetchall()
db.conn.commit() # æ›´æ–°æŸ¥è¯¢äº‹åŠ¡

# åº”ç”¨åœºæ™¯
# åœ¨éœ€è¦ä½¿ç”¨äº‹åŠ¡çš„æƒ…å†µä¸‹é€‰æ‹©innodbå¼•æ“
```

#### ç¬¬ä¸‰å‘¨2020/5/11-2020/5/15

```mysql
# æ’å…¥æ•°æ®ï¼Œè‹¥å”¯ä¸€é”®å†²çªåˆ™æ›´æ–°æ•°æ®
 insert into table (xxx, xxx) values(xxx,xxx), (xxx, xxx) on duplicate key update xxx=values(xxx),xxx=values(xxx);
 # ignore	å…³é”®å­—
 # å”¯ä¸€é”®å¦‚æœå†²çªåˆ™è·³è¿‡ä¸æ’å…¥
 insert ignore into table (xxx, xxx) values (xxx,xxx), (xxx, xxx);
 # Replace Into
 # å”¯ä¸€é”®å†²çªä¼šåˆ é™¤å†²çªæ•°æ®æ’å…¥æ–°æ•°æ®
 replace into table (xxx, xxx) values (xxx,xxx), (xxx, xxx);
```

#### ç¬¬å››å‘¨2020/5/18-2020/5/22

æœ¬å‘¨ä¿®æ”¹BUG

#### ç¬¬äº”å‘¨2020/5/25-2020/5/29

1. ç±»ï¼ˆç»§æ‰¿ã€å°è£…ã€å¤šæ€ï¼‰

2. pythonä¸‹åˆ’çº¿ä½¿ç”¨åœºæ™¯

3. pep8è§„èŒƒ

4. python è™šæ‹Ÿç¯å¢ƒå®‰è£…

   ```python
   # å®‰è£…è™šæ‹Ÿç¯å¢ƒ
   pip install pip install virtualenv virtualenvwrapper -i https://douban.pypi.com/simple
   # è®¾ç½®ç¯å¢ƒå˜é‡ 
   vi ~.bash_profile
   # æ·»åŠ å¦‚ä¸‹é…ç½®
   export WORKON_HOME=~/Envs   #è®¾ç½®virtualenvçš„ç»Ÿä¸€ç®¡ç†ç›®å½•
   export VIRTUALENVWRAPPER_VIRTUALENV_ARGS='--no-site-packages'   #æ·»åŠ virtualenvwrapperçš„å‚æ•°ï¼Œç”Ÿæˆå¹²å‡€éš”ç»çš„ç¯å¢ƒ
   export VIRTUALENVWRAPPER_PYTHON=/usr/local/python3/bin/python3     #æŒ‡å®špythonè§£é‡Šå™¨
   source /usr/local/python3/bin/virtualenvwrapper.sh #æ‰§è¡Œvirtualenvwrapperå®‰è£…è„šæœ¬
   # ä½¿é…ç½®ç”Ÿæ•ˆ
   source ~.bash_profile
   # å¦‚æœé‡åˆ°æŠ¥é”™ï¼švirtualenv: error: unrecognized arguments: --no-site-packages
   # é—®é¢˜åŸå› : virtualenvç‰ˆæœ¬é—®é¢˜
   # è§£å†³æ–¹æ¡ˆ: æŒ‡å®šç‰ˆæœ¬å®‰è£…
   pip uninstall virtualenv
   pip install virtualenv==16.7.9
   ```

#### ç¬¬å…­å‘¨2020/6/1-2020/6/5

1. nginxåå‘ä»£ç†

   ```nginx
   # ç”±äºç›®å‰æ•°æ®æ”¶é›†å’Œæ•°æ®å±•ç¤ºåœ¨åŒä¸€ä¸ªæœåŠ¡ç«¯é‡Œé¢ï¼Œç”±äºæ•°æ®æ”¶é›†å¹¶å‘é‡æ¯”è¾ƒå¤§ï¼Œå¯¼è‡´æ•°æ®å±•ç¤ºAPIè¯·æ±‚æ—¶ç¼“æ…¢ï¼Œéœ€è¦å°†æ•°æ®æ”¶é›†å’Œæ•°æ®å±•ç¤ºåˆ†ç¦»ï¼Œç›®å‰urlå‰ç¼€ä¸ºsdkä¸ºæ•°æ®æ”¶é›†ï¼Œdatashowä¸ºæ•°æ®å±•ç¤ºAPI
   # nginx é€šè¿‡é…ç½®locationåå‘ä»£ç†åˆ°ç›¸åº”çš„æœåŠ¡å™¨
   location /datashow/ {
     proxy_pass http://apis;
   } # åå‘ä»£ç†åˆ°æ•°æ®å±•ç¤ºAPI
   location /sdk/ {
     proxy_pass http://datashows;  # æ³¨ï¼šdatashows åé¢æ²¡æœ‰/ï¼Œå¦‚æœåŠ /åˆ™ä¼šåå‘ä»£ç†åˆ°sdkåé¢çš„uri,ä¾‹ï¼šhttp:domain/sdk/report/indexä¼šåå‘ä»£ç†åˆ°/report/indexï¼Œä¸åŠ /åˆ™ä¼šä»£ç†åˆ°/sdk/report/index
   } # åå‘ä»£ç†åˆ°æ•°æ®æ”¶é›†
   ```

2. mongodbä¸»ä»é…ç½®

   ```mongodb
   # mongodb4.0ä»¥åä¸åœ¨æ”¯æŒä¸»ä»é…ç½®
   # æŠ¥é”™:  Master/slave replication is no longer supported
   # ä½¿ç”¨Replica Setsè®°å½•ä¹‹
   # å‚è€ƒğŸ”—:https://mongoing.com/archives/38481   https://docs.mongodb.com/manual/core/replica-set-architectures/
   ```

3. tornadoå¼‚æ­¥éé˜»å¡è¯·æ±‚

   ```python
   # åç¨‹çš„ä½¿ç”¨ï¼Œä½¿ç”¨åç¨‹çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå½“é‡åˆ°IOé˜»å¡æ—¶ï¼Œä¼šå¤„ç†å…¶ä»–è¯·æ±‚ï¼Œç­‰åˆ°IOæˆåŠŸåï¼Œè¿”å›åˆ°ä¹‹å‰çš„çŠ¶æ€
   @tornado.web.asynchronous
   @tornado.gen.coroutine
   ```

4. webå‰ç«¯æ›´æ–°é¡µé¢åå¦‚ä½•åœ¨å®¢æˆ·ç«¯æ£€æµ‹å¹¶åˆ·æ–°ç¼“å­˜

   ```html
   # cssã€jsåœ¨æµè§ˆå™¨ä¸­å­˜åœ¨è¿‡æœŸæ—¶é—´ï¼Œä½†è¿‡æœŸæ—¶é—´æ²¡æœ‰è¿‡æœŸï¼Œä¼šä¸€ç›´ä½¿ç”¨æ—§çš„cssã€js
   # è§£å†³æ–¹æ¡ˆ
   # é€šè¿‡ç»™cssæ–‡ä»¶ã€jsæ–‡ä»¶æä¾›ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œå½“ä¸‹ä¸€æ”¹åŠ¨ï¼Œæ›´æ–°æœ€æ–°çš„ç‰ˆæœ¬å·ï¼Œæµè§ˆå™¨æ£€æµ‹åˆ°è¯¥cssã€jsæ–‡ä»¶ä¸æ˜¯æœ€æ–°çš„æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ç¼“å­˜æ–‡ä»¶
   1. æ›´æ”¹cssã€jsæ–‡ä»¶åæ–¹æ³•
   <link rel="stylesheet" href="index.v2011.css" />
   æ›´æ”¹å:
   <link rel="stylesheet" href="index.v2012.css" />
   2. cssæ–‡ä»¶åŠ ä¸ªç‰ˆæœ¬å·
   <link rel="stylesheet" href="style.css?v=2011" />
   æ›´æ”¹å:
   <link rel="stylesheet" href="style.css?v=2012" />
   
   æ³¨: éƒ¨åˆ†ä»£ç†ç¼“å­˜æœåŠ¡å™¨ä¸ä¼šç¼“å­˜ç½‘å€ä¸­åŒ…å« "?" çš„èµ„æºï¼Œæ‰€ä»¥æ–¹æ³•äºŒå¯èƒ½ä¼šå¯¼è‡´ä½ åŸå…ˆçš„ç¼“å­˜åŠŸèƒ½å¤±æ•ˆï¼Œå¯ä»¥æ”¹ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼›å…¶å®cssæ–‡ä»¶åé¢çš„é—®å·èµ·ä¸åˆ°å®é™…ä½œç”¨ï¼Œä»…èƒ½å½“ä½œåç¼€ï¼Œå¦‚æœç”¨é—®å·åŠ å‚æ•°çš„æ–¹æ³•ï¼Œå¯ä»¥æ·»åŠ ç‰ˆæœ¬å·ç­‰ä¿¡æ¯ï¼ŒåŒæ—¶å¯ä»¥åˆ·æ–°ä¸€ä¸‹æµè§ˆå™¨ç«¯çš„ç¼“å­˜ã€‚ä¸€ä¸ªå°å°çš„ç»†èŠ‚ï¼Œå¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤§çš„æ–¹ä¾¿
   ```

#### ç¬¬ä¸ƒå‘¨2020/6/8-2020/6/12

1. mongodbè¶…æ—¶é—®é¢˜

   ```mysql
   # ç”±äºæ•°æ®é‡è¿‡å¤§å¯¼è‡´mongodbè¶…æ—¶é—®é¢˜
   # pymongoæ“ä½œmongodbæ•°æ®
   # è§£å†³æ–¹æ¡ˆ1 ä½¿cursoræ¸¸æ ‡æ°¸ä¸è¶…æ—¶
   mongo.db["***"].find({}, {}, no_cursor_timeout=True)
   # è§£å†³æ–¹æ¡ˆ2 æ¸¸æ ‡ä¸è¶…æ—¶å¹¶åˆ†ç»„æ‰§è¡Œ
   mongo.db["***"].find({}, {}, no_cursor_timeout=True).batch_size(500)
   ```

2. tornadoè¯·æ±‚è¶…æ—¶é—®é¢˜

   ```
   # é—®é¢˜åˆ†æ: ç”±äºé‡åˆ°æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œå¯¼è‡´httpè¯·æ±‚é˜»å¡åœ¨IOè¯»å†™ä¸Šé¢
   # è§£å†³æ–¹æ¡ˆ: 1. å°†è€—æ—¶çš„IOæ“ä½œå•ç‹¬æå–å‡ºæ¥ï¼›2. ä½¿ç”¨tornadoå¼‚æ­¥éé˜»å¡è¯·æ±‚
   ```

3. rabbitMQæ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶å®‰è£…

   ```shell
   # centos8å®‰è£…æ–¹æ³•
   # ç¬¬ä¸€æ­¥ï¼šå®‰è£…erlangè¯­è¨€ï¼ˆæ³¨: éœ€è¦å’ŒrabbitMQç‰ˆæœ¬å¯¹åº”ï¼Œå…·ä½“è¯·æ±‚æŸ¥çœ‹é“¾æ¥:https://www.rabbitmq.com/which-erlang.htmlï¼‰
   # ä¾èµ–ç¯å¢ƒ
   yum -y install make gcc gcc-c++ kernel-devel m4 ncurses-devel openssl-devel
   yum -y install ncurses-devel
   # yum å®‰è£…
   yum install erlang
   # ä½¿ç”¨æºç å®‰è£…ï¼Œé“¾æ¥åœ°å€: https://erlang.org/download/otp_src_22.1.tar.gz
   #åˆ›å»ºç›®å½•(åå­—éšä¾¿ï¼Œèƒ½æ‰¾åˆ°å°±è¡Œ)
   mkdir /usr/local/erlang
   #è¿›å…¥ç›®å½•å‡†å¤‡ä¸‹è½½
   cd /usr/local/erlang/
   #å¼€å§‹ä¸‹è½½
   wget https://erlang.org/download/otp_src_22.1.tar.gz
   tar -zxvf otp_src_22.1.tar.gz 
   #è¿›å…¥è§£å‹ç›®å½•
   cd otp_src_22.1/
   #å®‰è£…,æ³¨æ„ç›®å½•ä½ç½®
   ./configure --prefix=/usr/local/erlang/otp_src_22.1/ --with-ssl --enable-hipe --enable-threads --enable-smp-support --enable-kernel-poll --without-javac
   #ç¼–è¯‘&&å®‰è£…
   make && make install
   #è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæŒ‰aè¾“å…¥ï¼ŒæŒ‰esc  è¾“å…¥ï¼šwqä¿å­˜ï¼Œqä¸ä¿å­˜ï¼‰
   vim /etc/profile
   #åŠ å…¥ä¸€æ¡ï¼š
   export PATH=$JAVA_HOME/bin/:$PATH:/usr/local/erlang/otp_src_22.1/bin:$PATH
   #è®©é…ç½®ç”Ÿæ•ˆ
   source /etc/profile
   #æŸ¥çœ‹erlangæ˜¯å¦å®‰è£…æˆåŠŸ
   erl
   
   # ç¬¬äºŒæ­¥: å®‰è£…socat
   # å…ˆæ‰§è¡Œ
   yum install socat
   # å¦‚æœæ²¡æœ‰rpmæ–‡ä»¶åˆ™æ‰§è¡Œä»¥ä¸‹
   wget http://repo.iotti.biz/CentOS/6/x86_64/socat-1.7.3.2-1.el6.lux.x86_64.rpm
   rpm -ivh socat-1.7.3.2-1.el6.lux.x86_64.rpm
   yum install socat-1.7.3.2-1
   
   # ç¬¬ä¸‰æ­¥: å®‰è£…rabbitmq
   # å®˜æ–¹https://www.rabbitmq.com/install-rpm.html#package-dependencies
   yum install rabbitmq-server-3.8.4-1.el7.noarch.rpm 
   # å¯åŠ¨webç®¡ç†é¡µé¢
   rabbitmq-plugins enable rabbitmq_management ï¼ˆhttp://127.0.0.1:15672ï¼‰
   # åå°å¯åŠ¨
   rabbitmq-server -detached
   # æŸ¥çœ‹å½“å‰æ‰€æœ‰ç”¨æˆ·
   rabbitmqctl list_users
   # æŸ¥çœ‹é»˜è®¤guestç”¨æˆ·çš„æƒé™
   rabbitmqctl list_user_permissions guest
   # ç”±äºRabbitMQé»˜è®¤çš„è´¦å·ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯guestã€‚ä¸ºäº†å®‰å…¨èµ·è§, å…ˆåˆ æ‰é»˜è®¤ç”¨æˆ·
   rabbitmqctl delete_user guest
   # æ·»åŠ æ–°ç”¨æˆ·
   rabbitmqctl add_user username password
   # è®¾ç½®ç”¨æˆ·tag
   rabbitmqctl set_user_tags username administrator
   # èµ‹äºˆç”¨æˆ·é»˜è®¤vhostçš„å…¨éƒ¨æ“ä½œæƒé™
   rabbitmqctl set_permissions -p / username ".*" ".*" ".*"
   # æŸ¥çœ‹ç”¨æˆ·çš„æƒé™
   rabbitmqctl list_user_permissions username
   # æ³¨æ„ï¼š 15672ç«¯å£æ˜¯è¿æ¥rabbitmqç”¨çš„
   
   # æ³¨: centos7 erlangç‰ˆæœ¬ä¸º5.10.4ï¼Œè¯·æ ¹æ®å®é™…erlangç‰ˆæœ¬å®‰è£…å…¼å®¹çš„rabbitmq
   ```

4. supervisorå®‰è£…

   ```shell
   # å®‰è£…
   yum install supervisor
   pip install supervisor
   # ç¼–è¾‘é…ç½®æ–‡ä»¶
   vi /etc/supervisord.conf
   ```

#### ç¬¬å…«å‘¨2020/6/15-2020/6/20

1. rabbitmqå†…å­˜ä¼˜åŒ–é…ç½®

   ```shell
    # å®é™…é—®é¢˜: rabbitmqé˜Ÿåˆ—è¶…å‡ºå®ä¾‹æœåŠ¡å™¨å¯ç”¨RAMå¤§å°ï¼Œå¯¼è‡´rabbitmqåœ¨æ²¡æœ‰åˆ°è¾¾æœ€å¤§åˆ†é¡µé˜ˆå€¼æ—¶å°±å·²ç»æŒ‚æ‰
    # è§£å†³æ–¹æ¡ˆ: é€šè¿‡è®¾ç½®rabbitmqæœ€å¤§å†…å­˜å€¼æ§åˆ¶æœ€å¤§åˆ†é¡µé˜ˆå€¼
    # å½“rabbitmqè¿è¡Œæ—¶è®¾ç½®
    rabbitmqctl set_vm_memory_high_watermark 0.4
    # å†…å­˜è®¡ç®—è¿‡ç¨‹
    # rabbitmqæœ€å¤§å†…å­˜vm_memory_high_watermarkï¼Œé»˜è®¤ä¸ºæœåŠ¡å™¨RAMçš„0.4ï¼Œæœ€å¤§åˆ†é¡µå†…å­˜vm_memory_high_watermark_paging_ratioé»˜è®¤ä¸ºæœ€å¤§å†…å­˜vm_memory_high_watermarkçš„0.5
    # vm_memory_high_watermark = RAM * 0.4
    # vm_memory_high_watermark_paging_ratio = RAM * 0.4 * 0.5
    # å‚è€ƒé“¾æ¥: https://www.rabbitmq.com/memory.html
   ```

2. mongodbå†…å­˜å ç”¨è¿‡é«˜é—®é¢˜

   ```shell
   # mongodb3.4å¼€å§‹ï¼Œé»˜è®¤ä½¿ç”¨WiredTigerå¼•æ“ï¼ŒWiredTigerå°†ç”¨äºæ‰€æœ‰æ•°æ®çš„å†…éƒ¨ç¼“å­˜çš„æœ€å¤§å¤§å°ï¼Œç´¢å¼•æ„å»ºæ¶ˆè€—çš„å†…å­˜ ä¸WiredTigerç¼“å­˜å†…å­˜æ˜¯åˆ†å¼€çš„ï¼›å€¼çš„èŒƒå›´å¯ä»¥ä»0.25GBåˆ°10000GB
   # å†…å­˜å¤§å°ï¼š50ï¼…ï¼ˆRAM-1 GB æˆ– 256 MBï¼›å†…å­˜å°äº256MBåˆ™å†…å­˜ä¸º256MB
   # å†…å­˜é…ç½®
   # mongodb.confæ–‡ä»¶ä¸­é…ç½® wiredTigerCacheSizeGB = 2
   # å‘½ä»¤è¡Œé…ç½® --wiredTigerCacheSizeGB <float>
   # é‡å¯mongodbï¼Œä¸è¦ä½¿ç”¨kill + mongodbPIDï¼Œä»¥ä¸‹ä¸ºæ­£ç¡®æ“ä½œ
   use admin
   db.shutdownServer()
   ```

3. emailã€smtplibå‘é€é‚®ä»¶

   ```python
   #!/usr/bin/python
   # -*- coding: UTF-8 -*-
    
   import smtplib
   from email.mime.text import MIMEText
   from email.header import Header
    
   # ç¬¬ä¸‰æ–¹ SMTP æœåŠ¡
   mail_host="smtp.XXX.com"  #è®¾ç½®æœåŠ¡å™¨
   mail_user="XXXX"    #ç”¨æˆ·å
   mail_pass="XXXXXX"   #æˆæƒå— 
   
   sender = 'from@runoob.com'
   receivers = ['429240967@qq.com']  # æ¥æ”¶é‚®ä»¶ï¼Œå¯è®¾ç½®ä¸ºä½ çš„QQé‚®ç®±æˆ–è€…å…¶ä»–é‚®ç®±
    
   message = MIMEText('Python é‚®ä»¶å‘é€æµ‹è¯•...', 'plain', 'utf-8')
   message['From'] = Header("sender<from@runoob.com>", 'utf-8')
   message['To'] =  Header("admin<429240967@qq.com>", 'utf-8')
    
   subject = 'Python SMTP é‚®ä»¶æµ‹è¯•'
   message['Subject'] = Header(subject, 'utf-8')
   
   try:
       smtpObj = smtplib.SMTP() 
       smtpObj.connect(mail_host, 25)    # 25 ä¸º SMTP ç«¯å£å·
       # smtpObj = smtplib.SMTP_SSL(mail_host)  # ä½¿ç”¨SSLç«¯å£å·ç™»å½•
       smtpObj.login(mail_user,mail_pass)  
       smtpObj.sendmail(sender, receivers, message.as_string())
       print "é‚®ä»¶å‘é€æˆåŠŸ"
   except smtplib.SMTPException:
       print "Error: æ— æ³•å‘é€é‚®ä»¶"
       
   # æ³¨: 554æŠ¥é”™ï¼Œé‚®ä»¶å‘ä»¶äººFromå’Œæ”¶ä»¶äººToçš„æ ¼å¼éœ€è¦æ”¹ä¸º'admin<429240967@qq.com>;user<1111111@qq.com>'
   ```


#### ç¬¬ä¹å‘¨2020/6/22-2020/6/26

1. Redis ç¼“å­˜

   ```
   pass
   ```

2. gitè¡¨æƒ…

   | emoji            | emojiä»£ç                   | commit è¯´æ˜           |
   | ---------------- | -------------------------- | --------------------- |
   | ? (è°ƒè‰²æ¿)       | :art:                      | æ”¹è¿›ä»£ç ç»“æ„/ä»£ç æ ¼å¼ |
   | âš¡ï¸ (é—ªç”µ)? (èµ›é©¬) | :zap:â€œ:racehorse:          | æå‡æ€§èƒ½              |
   | ? (ç«ç„°)         | :fire:                     | ç§»é™¤ä»£ç æˆ–æ–‡ä»¶        |
   | ? (bug)          | :bug:                      | ä¿®å¤ bug              |
   | ? (æ€¥æ•‘è½¦)       | :ambulance:                | é‡è¦è¡¥ä¸              |
   | âœ¨ (ç«èŠ±)         | :sparkles:                 | å¼•å…¥æ–°åŠŸèƒ½            |
   | ? (å¤‡å¿˜å½•)       | :memo:                     | æ’°å†™æ–‡æ¡£              |
   | ? (ç«ç®­)         | :rocket:                   | éƒ¨ç½²åŠŸèƒ½              |
   | ? (å£çº¢)         | :lipstick:                 | æ›´æ–° UI å’Œæ ·å¼æ–‡ä»¶    |
   | ? (åº†ç¥)         | :tada:                     | åˆæ¬¡æäº¤              |
   | âœ… (ç™½è‰²å¤é€‰æ¡†)   | :white_check_mark:         | å¢åŠ æµ‹è¯•              |
   | ? (é”)           | :lock:                     | ä¿®å¤å®‰å…¨é—®é¢˜          |
   | ? (è‹¹æœ)         | :apple:                    | ä¿®å¤ macOS ä¸‹çš„é—®é¢˜   |
   | ? (ä¼é¹…)         | :penguin:                  | ä¿®å¤ Linux ä¸‹çš„é—®é¢˜   |
   | ? (æ——å¸œ)         | :checked_flag:             | ä¿®å¤ Windows ä¸‹çš„é—®é¢˜ |
   | ? (ä¹¦ç­¾)         | :bookmark:                 | å‘è¡Œ/ç‰ˆæœ¬æ ‡ç­¾         |
   | ? (è­¦è½¦ç¯)       | :rotating_light:           | ç§»é™¤ linter è­¦å‘Š      |
   | ? (æ–½å·¥)         | :construction:             | å·¥ä½œè¿›è¡Œä¸­            |
   | ? (ç»¿å¿ƒ)         | :green_heart:              | ä¿®å¤ CI æ„å»ºé—®é¢˜      |
   | â¬‡ï¸ (ä¸‹é™ç®­å¤´)     | :arrow_down:               | é™çº§ä¾èµ–              |
   | â¬†ï¸ (ä¸Šå‡ç®­å¤´)     | :arrow_up:                 | å‡çº§ä¾èµ–              |
   | ? (å·¥äºº)         | :construction_worker:      | æ·»åŠ  CI æ„å»ºç³»ç»Ÿ      |
   | ? (ä¸Šå‡è¶‹åŠ¿å›¾)   | :chart_with_upwards_trend: | æ·»åŠ åˆ†ææˆ–è·Ÿè¸ªä»£ç     |
   | ? (é”¤å­)         | :hammer:                   | é‡å¤§é‡æ„              |
   | â– (å‡å·)         | :heavy_minus_sign:         | å‡å°‘ä¸€ä¸ªä¾èµ–          |
   | ? (é²¸é±¼)         | :whale:                    | Docker ç›¸å…³å·¥ä½œ       |
   | â• (åŠ å·)         | :heavy_plug_sign:          | å¢åŠ ä¸€ä¸ªä¾èµ–          |
   | ? (æ‰³æ‰‹)         | :wrench:                   | ä¿®æ”¹é…ç½®æ–‡ä»¶          |
   | ? (åœ°çƒ)         | :globe_with_meridians:     | å›½é™…åŒ–ä¸æœ¬åœ°åŒ–        |
   | âœï¸ (é“…ç¬”)         | :pencil2:                  | ä¿®å¤ typo             |

#### ç¬¬åå‘¨2020/6/29-2020/7/3

1. nginxå›¾ç‰‡è¿‡æ»¤å™¨HttpImageFilter

   ```nginx
   # http_image_filter_moduleæ˜¯nginxæä¾›çš„é›†æˆå›¾ç‰‡å¤„ç†æ¨¡å—ï¼Œæ”¯æŒnginx-0.7.54ä»¥åçš„ç‰ˆæœ¬ï¼Œåœ¨ç½‘ç«™è®¿é—®é‡ä¸æ˜¯å¾ˆé«˜ç£ç›˜æœ‰é™ä¸æƒ³ç”Ÿæˆå¤šä½™çš„å›¾ç‰‡æ–‡ä»¶çš„å‰æä¸‹ï¼Œå°±å¯ä»¥ç”¨å®ƒå®æ—¶ç¼©æ”¾å›¾ç‰‡ï¼Œæ—‹è½¬å›¾ç‰‡ï¼ŒéªŒè¯å›¾ç‰‡æœ‰æ•ˆæ€§ä»¥åŠè·å–å›¾ç‰‡å®½é«˜ä»¥åŠå›¾ç‰‡ç±»å‹ä¿¡æ¯ï¼Œç”±äºæ˜¯å³æ—¶è®¡ç®—çš„ç»“æœï¼Œæ‰€ä»¥ç½‘ç«™è®¿é—®é‡å¤§çš„è¯ï¼Œä¸å»ºè®®ä½¿ç”¨
   # å®‰è£…
   # yum install gd-devel
   --with-http_image_filter_module  # å‘½ä»¤å‚æ•°
   
   # æŒ‡ä»¤
   image_filter  # è¿‡æ»¤JPEGã€GIFã€PNGå›¾ç‰‡å¹¶è®¾ç½®æˆ–è€…è£å‰ªå›¾ç‰‡å¤§å°
   image_filter_buffer  # è®¾ç½®è¯»å–å›¾ç‰‡çš„æœ€å¤§å°ºå¯¸ã€é»˜è®¤1m
   image_filter_jpeg_quality  # è®¾ç½®å›¾ç‰‡ä½œä¸ºJPEGå¤„ç†æ—¶çš„ä¿¡æ¯ä¸¢å¤±ç‡ã€é»˜è®¤75ã€æœ€å¤§95
   image_filter_transparency  # 
   ```

2. nginxé…ç½®æ–‡ä»¶ä¸Šä¼ å¤§å°

   ```nginx
   client_max_body_size 1024M;  # ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶
   sendfile on;  # è®¾ç½®ä¸ºonè¡¨ç¤ºå¯åŠ¨é«˜æ•ˆä¼ è¾“æ–‡ä»¶çš„æ¨¡å¼
   keepalive_timeout 1800;  # ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œé»˜è®¤65s
   ```

3. nginxé˜²ç›—é“¾

   ```nginx
   # åŸå› ï¼Œæœ¬åœ°æœåŠ¡å™¨é™æ€æ–‡ä»¶å¦‚å›¾ç‰‡ç­‰å¯ä»¥è¢«å…¶ä»–æœåŠ¡å™¨éšæ„è®¿é—®
   # é˜²ç›—é“¾åŸç†: æ ¹æ®è®¿é—®referençš„åŸŸåæ˜¯å¦å’Œæœ¬æœºåŸŸåä¸€æ ·ï¼Œä¸ä¸€æ ·åˆ™é‡å®šå‘åˆ°é”™è¯¯é¡µé¢ç­‰ï¼Œä¹Ÿå¯ä»¥å¯¹æŸäº›åŸŸåè·³è¿‡éªŒè¯
   valid_referers none blocked server_name *.test.com ;  # å¯¹è¿™äº›åŸŸåçš„ç½‘ç«™ä¸è¿›è¡Œé˜²ç›—é“¾ï¼Œå¤šä¸ªåœ°å€ç©ºæ ¼éš”å¼€
   ```

4. osså¯¹è±¡å­˜å‚¨æœåŠ¡

   ```shell
   # å®šä¹‰ï¼šå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆObject Storage Serviceï¼Œç®€ç§° OSSï¼‰ï¼Œæ˜¯é˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ APIï¼Œåœ¨ä»»ä½•åº”ç”¨ã€ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹ä¸Šä¼ å’Œä¸‹è½½æ•°æ®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Web æ§åˆ¶å°å¯¹æ•°æ®è¿›è¡Œç®€å•çš„ç®¡ç†
   # ä½¿ç”¨åœºæ™¯æµ·é‡å›¾ç‰‡ã€è§†é¢‘é™æ€èµ„æºä¸‹è½½ç­‰ï¼Œå¯ç”ŸæˆåŠ¨æ€é“¾æ¥è®¿é—®é™æ€èµ„æºå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´
   ```

#### ç¬¬åä¸€å‘¨2020/7/6-2020/7/10

1. redisç¼“å­˜é—®é¢˜

   ```
   1. ç¼“å­˜é›ªå´©
   åŸå› ï¼šåœ¨æŸä¸€æ—¶åˆ»ï¼Œæœ‰å¤šä¸ªç¼“å­˜è¿‡æœŸï¼Œæ­¤æ—¶éœ€è¦ä»DBä¸­è·å–æ•°æ®ï¼Œå¦‚æœåœ¨é«˜å¹¶å‘é‡æœåŠ¡å™¨ä¸Šï¼Œæ­¤æ—¶DBçš„å‹åŠ›ä¼šå¾ˆå¤§ï¼Œå¾ˆå¯èƒ½é€ æˆæœåŠ¡å™¨æŒ‚æ‰
   è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥å¯¹ä¸åŒçš„keyå€¼è®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œä½¿ç¼“å­˜è¿‡æœŸæ—¶é—´å°½é‡å‡åŒ€åˆ†å¸ƒ
   2. ç¼“å­˜ç©¿é€
   åŸå› ï¼šå½“å®¢æˆ·ç«¯è®¿é—®æŸä¸€ç¼“å­˜æ—¶ï¼Œå¦‚æœç¼“å­˜å±‚å’ŒDBå±‚éƒ½æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®ï¼Œæ­¤æ—¶å‹åŠ›å°±ä¼šåœ¨DBå±‚ï¼Œå¦‚æœä¸€ç›´å¯¹è¯¥ç¼“å­˜è¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ™ä¼šå‡ºç°å¾ˆä¸¥é‡çš„åæœ
   è§£å†³æ–¹æ¡ˆï¼šå¯¹äºDBå±‚ä¹Ÿæ²¡æœ‰çš„æ•°æ®ï¼Œä¹Ÿè®¾ç½®ç¼“å­˜ï¼Œå¯¹åº”çš„valueä¸ºç©ºæŒ‡å¤„ç†ï¼Œå¹¶è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´
   3. ç¼“å­˜å‡»ç©¿
   åŸå› ï¼šåœ¨é«˜å¹¶å‘è¯·æ±‚ä¸‹ï¼ŒæŸä¸€æ—¶åˆ»ä¸€ä¸ªçƒ­ç‚¹ç¼“å­˜è¿‡æœŸï¼Œæ­¤æ—¶å‹åŠ›ä¼šåœ¨DBå±‚ï¼Œå¹¶ä¸”åŒæ—¶å¯¹è¯¥çƒ­ç‚¹è¿›è¡Œå†™æ“ä½œ
   è§£å†³æ–¹æ¡ˆï¼šåœ¨å†™å…¥ç¼“å­˜çš„æ—¶å€™åŠ é”
   ```

2. redisæŒä¹…åŒ–è®¾ç½®

   ```
   # redis æŒä¹…åŒ–æœ‰ä¸¤ä¸­ï¼Œä¸€ç§æ˜¯RDBã€ä¸€ç§æ˜¯AOF
   1. RDBæ–‡æœ¬ä¸ºredisæ•°æ®åº“æŸä¸€æ—¶åˆ»çš„å¿«ç…§å‹ç¼©æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æ‰‹åŠ¨å’Œè‡ªåŠ¨æ¥è¿›è¡Œå¤‡ä»½
   æ‰‹åŠ¨: åœ¨ç»ˆç«¯å‘½ä»¤ä¸­è¾“å…¥saveå‘½ä»¤å³å¼€å§‹å¤‡ä»½æ•°æ®ï¼Œä¼šé˜»å¡æœåŠ¡å™¨ï¼Œæ­¤æ—¶æœåŠ¡å™¨ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œ
   è‡ªåŠ¨ï¼šåœ¨ç»ˆç«¯å‘½ä»¤ä¸­è¾“å…¥bgsaveå‘½ä»¤ï¼Œæ­¤æ—¶redisä¼šä½¿ç”¨forkå¼€å¯ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œæ•°æ®å¤‡ä»½ï¼Œä¸ä¼šé˜»å¡æœåŠ¡å™¨
   2. AOFæ–‡ä»¶å­˜å‚¨çš„æ˜¯å„ç§å‘½ä»¤ï¼Œå¯¹äºé‡å¤çš„å‘½ä»¤ï¼ŒAOFå†…éƒ¨æœ‰ä¸€ä¸ªé‡åˆ¶æœºåˆ¶ï¼Œå»é™¤é‡å¤çš„æ“ä½œ
   å¼€å¯AOFæ•°æ®å¤‡ä»½åï¼Œredisé—´éš”ä¸€æ®µæ—¶é—´å¯¹æ•°æ®ä»¥å‘½ä»¤çš„å½¢å¼ä¿å­˜åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­åŒæ—¶ä¼šforkä¸€ä¸ªæ–°è¿›ç¨‹å¯¹æ–‡ä»¶è¿›è¡Œé‡å†™
   ```

3. rabbitmqçš„exchangeå’Œqueue

   ```
   1. exchangeç±»å‹
   1) direct é»˜è®¤
   ç›´æ¥äº¤æ¢å™¨ï¼Œå¯¹routingè·¯ç”±è¿›è¡Œå®Œå…¨åŒ¹é…
   2ï¼‰fanout
   å¹¿æ’­å¼äº¤æ¢å™¨ï¼Œå°†æ¶ˆæ¯è½¬å‘ç»™ç»‘å®šè·¯ç”±çš„é˜Ÿåˆ—
   3ï¼‰topic
   ä¸»é¢˜äº¤æ¢å™¨ï¼Œå°†æ¶ˆæ¯è½¬å‘ç»™åŒ¹é…è·¯ç”±æˆåŠŸçš„é˜Ÿåˆ—
   4ï¼‰headers
   æ¶ˆæ¯ä½“headeråŒ¹é…
   
   2. queueç±»å‹
   1ï¼‰æŒä¹…åŒ–é˜Ÿåˆ—ï¼Œqueueä¸­çš„æ¶ˆæ¯ä¼šåœ¨serveræœ¬åœ°ç£ç›˜å­˜å‚¨ä¸€ä»½ï¼Œé˜²æ­¢ç³»ç»Ÿcrashï¼Œæ•°æ®ä¸¢å¤±
   2ï¼‰ä¸´æ—¶é˜Ÿåˆ—ï¼Œqueueä¸­çš„æ¶ˆæ¯åœ¨æœåŠ¡é‡å¯åå°±ä¼šä¸¢å¤±
   3ï¼‰è‡ªåŠ¨åˆ é™¤çš„é˜Ÿåˆ—ï¼Œå½“ä¸å­˜åœ¨ç”¨æˆ·è¿æ¥åˆ°serverï¼Œé˜Ÿåˆ—ä¸­çš„æ•°æ®ä¼šè¢«è‡ªåŠ¨åˆ é™¤
   ```


#### ç¬¬åäºŒå‘¨2020/7/12-2020/7/17

1. æŸ¥çœ‹å†…å­˜å‰åçš„è¿›ç¨‹

   ```shell
   # æœåŠ¡å™¨çªç„¶å æ»¡ï¼ŒæŸ¥çœ‹ä¸»è¦å ç”¨å†…å­˜çš„è¿›ç¨‹
   ps aux | sort -k4,4nr | head -n 10
   ```

#### ç¬¬åä¸‰å‘¨2020/7/20-2020/7/24

1. mongodbæ—¥å¿—æ–‡ä»¶è¿‡å¤§é—®é¢˜

   ```shell
   # logpathé…ç½®æ—¥å¿—å‚æ•°ï¼Œä¼šä¸€ç›´å¾€æ—¥å¿—æ–‡ä»¶ä¸­è¿½åŠ æ—¥å¿—ä¿¡æ¯ï¼Œé•¿æ—¶é—´ä¼šç§¯ç´¯è¾ƒå¤§çš„æ—¥å¿—ä¿¡æ¯ï¼Œå ç”¨å†…å­˜ç©ºé—´
   # è§£å†³æ–¹æ¡ˆ1ï¼šæ‰‹åŠ¨ï¼Œé‡å¯ä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶
   # è§£å†³æ–¹æ¡ˆ2: å†™ä¸ªè„šæœ¬ï¼Œå†…å­˜åˆ°è¾¾å¤šå°‘ï¼Œæ‰§è¡Œå‘½ä»¤é‡å¯ä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶
   # è§£å†³æ–¹æ¡ˆ3: ç»™æœåŠ¡å™¨åŠ å†…å­˜ï¼ˆä¸å¤ªç°å®ï¼Œç”±äºå…¬å¸æœ‰ç‚¹æŠ ï¼Œå¯¹æ¯”potalç»„ï¼‰ï¼ŒæœåŠ¡å™¨ä¸€å°ï¼Œæµ‹è¯•æœºéƒ½æ²¡æœ‰ï¼Œç­‰ä¸€ä¸ªå´©æºƒï¼Œè¿™æ˜¯ç•™ç»™åäººçš„å‘
   db.runCommand({logRotate:1}) # é‡å¯æ–°çš„æ—¥å¿—æ–‡ä»¶
   ```

2. python æ‰“å°å¼‚å¸¸

   ```python
   # 1. æ­£å¸¸æ‰“å°å¼‚å¸¸
   try:
       pass
   except Exception as e:
       logging.error(e)
       
   # 2. traceback æŸ¥çœ‹å¼‚å¸¸å…·ä½“ä¿¡æ¯
   import traceback
   traceback.print_exc()
   
   # 3. sysæ¨¡å—æŸ¥çœ‹å¼‚å¸¸ä¿¡æ¯
   info = sys.exc_info()
   print(info)
   
   # 4. sysè·å–å‡½æ•°åå’Œè¡Œå·
   f = sys.exc_info()[2].tb_frame.f_back
   print(f.f_code.co_name, f.f_lineno)
   ```

3. dataclassé»˜è®¤å€¼

   ```python
   # defaultå’Œdefault_factoryå‚æ•°å°†ä¼šå½±å“é»˜è®¤å€¼çš„äº§ç”Ÿï¼Œå®ƒä»¬çš„é»˜è®¤å€¼éƒ½æ˜¯Noneï¼Œæ„æ€æ˜¯è°ƒç”¨æ—¶å¦‚æœä¸ºæŒ‡å®šåˆ™äº§ç”Ÿä¸€ä¸ªä¸ºNoneçš„å€¼ã€‚å…¶ä¸­defaultæ˜¯fieldçš„é»˜è®¤å€¼ï¼Œè€Œdefault_factoryæ§åˆ¶å¦‚ä½•äº§ç”Ÿå€¼ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæ— å‚æ•°æˆ–è€…å…¨æ˜¯é»˜è®¤å‚æ•°çš„callableå¯¹è±¡ï¼Œç„¶åç”¨è°ƒç”¨è¿™ä¸ªå¯¹è±¡è·å¾—fieldçš„åˆå§‹å€¼ï¼Œä¹‹åå†å°†defaultï¼ˆå¦‚æœå€¼ä¸æ˜¯MISSINGï¼‰å¤åˆ¶ç»™callableè¿”å›çš„è¿™ä¸ªå¯¹è±¡
   @dataclass
   class C:
       mylist: List[int] = field(default_factory=list)
   # initå‚æ•°å¦‚æœè®¾ç½®ä¸ºFalseï¼Œè¡¨ç¤ºä¸ä¸ºè¿™ä¸ªfieldç”Ÿæˆåˆå§‹åŒ–æ“ä½œï¼Œdataclassæä¾›äº†hookâ€”â€”__post_init__ä¾›æˆ‘ä»¬åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œ__post_init__åœ¨__init__åè¢«è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œåˆå§‹åŒ–é‚£äº›éœ€è¦å‰ç½®æ¡ä»¶çš„field
   @dataclass
   class C:
       a: int
       b: int
       c: int = field(init=False)
   
       def __post_init__(self):
           self.c = self.a + self.b
   # å¦‚æœæŒ‡å®šä¸€ä¸ªfieldçš„ç±»å‹æ³¨è§£ä¸ºdataclasses.InitVar, é‚£ä¹ˆè¿™ä¸ªfieldå°†åªä¼šåœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼ˆ__init__å’Œ__post_init__ï¼‰å¯ä»¥è¢«ä½¿ç”¨
   @dataclass
   class C:
       i: int
       j: int = None
       database: InitVar[DatabaseType] = None
   
       def __post_init__(self, database):
           if self.j is None and database is not None:
               self.j = database.lookup('j')
   
   c = C(10, database=my_database)
   ```

4. Superã€æ–°å¼ç±»å’Œç»å…¸ç±»

   ```python
   # superè·å–çˆ¶ç±»æ–¹æ³•ï¼Œå¯ä»¥è°ƒç”¨çˆ¶ç±»æ–¹æ³•
   class A(object):
     
     def __init__(self, a):
       self.a = a
       
   class B(A):
     
     def __init__(self, a, b):
       super(B, self).__init__(a)
       self.b = b
   
   # æ–°å¼ç±»å’Œç»å…¸ç±»
   # æ–°å¼ç±»å¤šç»§æ‰¿é‡‡ç”¨å¹¿åº¦ä¼˜å…ˆçš„æ–¹å¼æŸ¥æ‰¾çˆ¶ç±»ï¼Œå¦‚é’»çŸ³ç»§æ‰¿
   # ç»å…¸ç±»é‡‡ç”¨æ·±åº¦ä¼˜å…ˆçš„æ–¹å¼æŸ¥æ‰¾çˆ¶ç±»
   # cls.mro() æŸ¥çœ‹çˆ¶ç±»çš„é¡ºåº
   ```


## ç¬¬åäº”å‘¨2020/8/10-2020/8/14

1. åˆ é™¤æ•°æ®åº“é˜»å¡

   ```mysql
   show full processlist;
   # æŸ¥çœ‹
   ```

2. é¡µé¢æ§åˆ¶å°å‘½ä»¤ç›´æ¥ä¿®æ”¹ç½‘é¡µå†…å®¹

   ```javascript
   document.body.contentEditable = true;
   ```


## ç¬¬åä¸ƒå‘¨2020/8/30-2020/9/4

1. mydumperå®‰è£…åŠåŸç†

   ```
   # ç‰¹æ€§
   1. ä½¿ç”¨å¤šçº¿ç¨‹å¤‡ä»½æ•°æ®ï¼Œå¤‡ä»½åä¼šå­˜åœ¨å¤šä¸ªå¤‡ä»½æ–‡ä»¶
   2. å¤‡ä»½æ—¶å¯¹MyISAMè¡¨æ–½åŠ FTWRL(FLUSH TABLES WITH READ LOCK),ä¼šé˜»å¡DMLè¯­å¥(å¢åˆ æ”¹)
   3. ä¿è¯å¤‡ä»½æ•°æ®çš„ä¸€è‡´æ€§
   4. æ”¯æŒæ–‡ä»¶å‹ç¼©ã€å¯¼å‡ºbinlogæ–‡ä»¶
   5. æ”¯æŒå¤šçº¿ç¨‹æ¢å¤
   6. æ”¯æŒä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å·¥ä½œï¼Œå®šæ—¶å¿«ç…§å’Œè¿ç»­äºŒè¿›åˆ¶æ—¥å¿—
   7. æ”¯æŒå°†å¤‡ä»½æ–‡ä»¶åˆ‡å—
   
   # å®‰è£…
   1. å®‰è£…ä¾èµ–åŒ…
   yum install glib2-devel mysql-devel zlib-devel pcre-devel openssl-devel cmake make
   2. ä¸‹è½½äºŒè¿›åˆ¶åŒ…
   wget https://launchpadlibrarian.net/225370879/mydumper-0.9.1.tar.gz
   tar -zxvf mydumper-0.9.1.tar.gz -C /usr/local/  # è§£å‹
   mv mydumper-0.9.1 mydumper  
   cd   /usr/local/mydumper  
   cmake .
   make && make install # ç¼–è¯‘
   3. æŸ¥çœ‹å®‰è£…æ˜¯å¦æˆåŠŸ
   mydumper -V
   # å¦‚æœæŠ¥é”™ï¼Œmydumper: error while loading shared libraries: libmysqlclient.so.20: cannot open shared object file: No such file or directory,è¯´æ˜ç¼ºå°‘mysqlä¾èµ–æ–‡ä»¶
   ldd /usr/local/bin/mydumper  # æŸ¥çœ‹mydumperä¾èµ–æ–‡ä»¶
   cp /usr/local/mysql/lib/libmysqlclient.so.20 /usr/lib/  # å¤åˆ¶mysqlä¸­çš„ä¾èµ–æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•
   ldconfig  # é»˜è®¤å¾€å¾€/libå’Œ/usr/libé‡Œé¢åŠ ä¸œè¥¿
   
   4. å¤‡ä»½å’Œæ¢å¤
   ###å¤‡ä»½å•ä¸ªåº“ 
   mydumper -u root -p ### -h localhost -B game -c -o /backup/01
   ###å¤‡ä»½æ‰€æœ‰æ•°æ®åº“ï¼Œå¹¶å¤‡ä»½äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶ï¼Œå¤‡ä»½è‡³ /backup/02 æ–‡ä»¶å¤¹
   mydumper -u root -p ### -h localhost -o /backup/02
   ###å¤‡ä»½ game.tb_player è¡¨ï¼Œä¸”ä¸å¤‡ä»½è¡¨ç»“æ„ï¼Œå¤‡ä»½è‡³ /backup/03 æ–‡ä»¶å¤¹
   mydumper -u root -p ### -h localhost -T tb_player -m -o /backup/03
   ###å‹ç¼©åè®®è¿˜åŸ
   myloader -u root -p ### -h localhost -B game -d -C /backup/02
   
   5. å‚æ•°
   mydumper å‚æ•°
   
   -B, --database              è¦å¤‡ä»½çš„æ•°æ®åº“ï¼Œä¸æŒ‡å®šåˆ™å¤‡ä»½æ‰€æœ‰åº“
   -T, --tables-list           éœ€è¦å¤‡ä»½çš„è¡¨ï¼Œåå­—ç”¨é€—å·éš”å¼€
   -o, --outputdir             å¤‡ä»½æ–‡ä»¶è¾“å‡ºçš„ç›®å½•
   -s, --statement-size        ç”Ÿæˆçš„insertè¯­å¥çš„å­—èŠ‚æ•°ï¼Œé»˜è®¤1000000
   -r, --rows                  å°†è¡¨æŒ‰è¡Œåˆ†å—æ—¶ï¼ŒæŒ‡å®šçš„å—è¡Œæ•°ï¼ŒæŒ‡å®šè¿™ä¸ªé€‰é¡¹ä¼šå…³é—­ --chunk-filesize
   -F, --chunk-filesize        å°†è¡¨æŒ‰å¤§å°åˆ†å—æ—¶ï¼ŒæŒ‡å®šçš„å—å¤§å°ï¼Œå•ä½æ˜¯ MB
   -c, --compress              å‹ç¼©è¾“å‡ºæ–‡ä»¶
   -e, --build-empty-files     å¦‚æœè¡¨æ•°æ®æ˜¯ç©ºï¼Œè¿˜æ˜¯äº§ç”Ÿä¸€ä¸ªç©ºæ–‡ä»¶ï¼ˆé»˜è®¤æ— æ•°æ®åˆ™åªæœ‰è¡¨ç»“æ„æ–‡ä»¶ï¼‰
   -x, --regex                 æ˜¯åŒæ­£åˆ™è¡¨è¾¾å¼åŒ¹é… 'db.table'
   -i, --ignore-engines        å¿½ç•¥çš„å­˜å‚¨å¼•æ“ï¼Œç”¨éƒ½åšåˆ†å‰²
   -m, --no-schemas            ä¸å¤‡ä»½è¡¨ç»“æ„
   -k, --no-locks              ä¸ä½¿ç”¨ä¸´æ—¶å…±äº«åªè¯»é”ï¼Œä½¿ç”¨è¿™ä¸ªé€‰é¡¹ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´
   --less-locking              å‡å°‘å¯¹InnoDBè¡¨çš„é”æ–½åŠ æ—¶é—´ï¼ˆè¿™ç§æ¨¡å¼çš„æœºåˆ¶ä¸‹æ–‡è¯¦è§£ï¼‰
   -l, --long-query-guard      è®¾å®šé˜»å¡å¤‡ä»½çš„é•¿æŸ¥è¯¢è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ï¼Œé»˜è®¤æ˜¯60ç§’ï¼ˆè¶…æ—¶åé»˜è®¤mydumperå°†ä¼šé€€å‡ºï¼‰
   --kill-long-queries         æ€æ‰é•¿æŸ¥è¯¢ (ä¸é€€å‡º)
   -b, --binlogs               å¯¼å‡ºbinlog
   -D, --daemon                å¯ç”¨å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼Œå®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ä»¥æŸä¸ªé—´éš”ä¸é—´æ–­å¯¹æ•°æ®åº“è¿›è¡Œå¤‡ä»½
   -I, --snapshot-interval     dumpå¿«ç…§é—´éš”æ—¶é—´ï¼Œé»˜è®¤60sï¼Œéœ€è¦åœ¨daemonæ¨¡å¼ä¸‹
   -L, --logfile               ä½¿ç”¨çš„æ—¥å¿—æ–‡ä»¶å(mydumperæ‰€äº§ç”Ÿçš„æ—¥å¿—), é»˜è®¤ä½¿ç”¨æ ‡å‡†è¾“å‡º
   --tz-utc                    è·¨æ—¶åŒºæ˜¯ä½¿ç”¨çš„é€‰é¡¹ï¼Œä¸è§£é‡Šäº†
   --skip-tz-utc               åŒä¸Š
   --use-savepoints            ä½¿ç”¨savepointsæ¥å‡å°‘é‡‡é›†metadataæ‰€é€ æˆçš„é”æ—¶é—´ï¼Œéœ€è¦ SUPER æƒé™
   --success-on-1146           Not increment error count and Warning instead of Critical in case of table doesn't exist
   -h, --host                  è¿æ¥çš„ä¸»æœºå
   -u, --user                  å¤‡ä»½æ‰€ä½¿ç”¨çš„ç”¨æˆ·
   -p, --password              å¯†ç 
   -P, --port                  ç«¯å£
   -S, --socket                ä½¿ç”¨socketé€šä¿¡æ—¶çš„socketæ–‡ä»¶
   -t, --threads               å¼€å¯çš„å¤‡ä»½çº¿ç¨‹æ•°ï¼Œé»˜è®¤æ˜¯4
   -C, --compress-protocol     å‹ç¼©ä¸mysqlé€šä¿¡çš„æ•°æ®
   -V, --version               æ˜¾ç¤ºç‰ˆæœ¬å·
   -v, --verbose               è¾“å‡ºä¿¡æ¯æ¨¡å¼, 0 = silent, 1 = errors, 2 = warnings, 3 = info, é»˜è®¤ä¸º 2
   
   myloaderä½¿ç”¨å‚æ•°
   
   -d, --directory                   å¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶å¤¹
   -q, --queries-per-transaction     æ¯æ¬¡äº‹ç‰©æ‰§è¡Œçš„æŸ¥è¯¢æ•°é‡ï¼Œé»˜è®¤æ˜¯1000
   -o, --overwrite-tables            å¦‚æœè¦æ¢å¤çš„è¡¨å­˜åœ¨ï¼Œåˆ™å…ˆdropæ‰è¯¥è¡¨ï¼Œä½¿ç”¨è¯¥å‚æ•°ï¼Œéœ€è¦å¤‡ä»½æ—¶å€™è¦å¤‡ä»½è¡¨ç»“æ„
   -B, --database                    éœ€è¦è¿˜åŸçš„æ•°æ®åº“
   -e, --enable-binlog               å¯ç”¨è¿˜åŸæ•°æ®çš„äºŒè¿›åˆ¶æ—¥å¿—
   -h, --host                        ä¸»æœº
   -u, --user                        è¿˜åŸçš„ç”¨æˆ·
   -p, --password                    å¯†ç 
   -P, --port                        ç«¯å£
   -S, --socket                      socketæ–‡ä»¶
   -t, --threads                     è¿˜åŸæ‰€ä½¿ç”¨çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤æ˜¯4
   -C, --compress-protocol           å‹ç¼©åè®®
   -V, --version                     æ˜¾ç¤ºç‰ˆæœ¬
   -v, --verbose                     è¾“å‡ºæ¨¡å¼, 0 = silent, 1 = errors, 2 = warnings, 3 = info, é»˜è®¤ä¸º2
   ```

2. Mysql è¡¨çº§é”å’Œè¡Œçº§é”

   è¡¨çº§é”ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ï¼›
   è¡Œçº§é”ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦ä¹Ÿæœ€é«˜ï¼›

   - **è¡¨çº§é”**

     ä¸¤ç§é”æ¨¡å¼ï¼šè¡¨å…±äº«è¯»é”ã€è¡¨ç‹¬å å†™é”

     å…¼å®¹æ€§ï¼š

     1. å¯¹MyISAMè¡¨çš„è¯»æ“ä½œï¼Œä¸ä¼šé˜»å¡å…¶ä»–ç”¨æˆ·å¯¹åŒä¸€è¡¨çš„è¯»è¯·æ±‚ï¼Œä½†ä¼šé˜»å¡å¯¹åŒä¸€è¡¨çš„å†™è¯·æ±‚ï¼›
     2. å¯¹MyISAMè¡¨çš„å†™æ“ä½œï¼Œåˆ™ä¼šé˜»å¡å…¶ä»–ç”¨æˆ·å¯¹åŒä¸€è¡¨çš„è¯»å’Œå†™æ“ä½œï¼›

     MyISAMå¯¹è¡¨çš„è¯»æ“ä½œå’Œå†™æ“ä½œä¹‹é—´ï¼›å½“ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°å†™é”ï¼Œåªæœ‰æŒæœ‰é”çš„çº¿ç¨‹å¯¹è¡¨è¿›è¡Œæ›´æ–°æ“ä½œï¼›å…¶ä»–çº¿ç¨‹è¯»ã€å†™æ“ä½œéƒ½ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼ŒçŸ¥é“é”è¢«é‡Šæ”¾ï¼›

     åŠ é”ä¼˜åŒ–å»ºè®®ï¼š

     1. ç¼©çŸ­é”å®šæ—¶é—´

        1. å°½é‡å‡å°‘å¤§çš„å¤æ‚Queryï¼Œå¯ä»¥çš„è¯è®²å¤æ‚çš„Queryæ‹†åˆ†ä¸ºå‡ ä¸ªå°çš„Queryåˆ†å¸ƒè¿›è¡Œï¼›
        2. å°½å¯èƒ½åˆ›å»ºè¶³å¤Ÿé«˜æ•ˆçš„ç´¢å¼•ï¼Œè®©æŸ¥è¯¢æ•ˆç‡æ›´å¿«ï¼›
        3. åˆé€‚çš„è¿›è¡Œåˆ†è¡¨åˆ†åº“ï¼›

     2. åˆ†ç¦»å¹¶è¡Œçš„æ“ä½œ

        

   

